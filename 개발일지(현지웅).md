# 개발일지 (현지웅)
### 지금까지의 과정



#### 5월 20일
- __친구 API를 성공적으로 사용하게 되었고, 이젠 그 나온 결과를 alert 하는 것이 아니라 변수로 만들어서 전달해야 한다.__<br>
javascript의 변수를 어떻게 하면 python으로 전달할 수 있는지 사실 몰랐다. 결국 여러 키워드를 검색하다가 도움을 받은 블로그를 통하여 해결하였다.
<br> (도움 받은 블로그: https://www.makeuseof.com/tag/python-javascript-communicate-json/)<br>

- __Kakao API를 JavaScript로 사용한 결과로 얻은 json을 Python 변수로 전달해주기 위해서 ajax(post)를 이용해서 전달하고자 하였다.__
그런데 왜 dataType을 json으로 하면 오류가 났다. 결국 text로 바꾸어 봤는데 성공... 뭘까?
<br>(나름 도움을 받았던 링크: https://okky.kr/article/389900)<br>

- 결론적으로 text로 하게 되어서 ```Flask```의 ```get_json``` 함수 대신 ```get_data```를 통해서 바이너리 데이터 형태로 정보를 받게 되었다.
바이너리 string을 decode한 후에도 url이 인코딩되어 있는 형태라서 결국은 ```urllib.parse.unquote``` 함수를 이용해서 한번 더 디코딩을 하게 되었다.
<br>(도움 받은 링크: https://stackoverflow.com/questions/16566069/url-decode-utf-8-in-python)
- 팀원 태현이가 ```face recognition open source```를 팀원 각자 프로필 사진과 단체 사진을 통하여 우리를 인식할 수 있는지에 대해서 실험을 해주었다.
하지만 가장 힘들었던 점이 그 api를 사용하기 위해서 설치해야 하는 과정이였다. (특히 윈도우에서 작업을 하는 우리 환경에서 그 API는 윈도우를 공식적으로 지원하고 있지는 않았다.)
오늘 나도 두 part를 잇기 위해서 설치를 하게 되었는데 많은 사람들이 겪는 CMAKE 설치와 환경변수 설정 문제였다. 다행히 나는 금방 해결!<br>

- __PyCharm에 project interpreter를 적용하는데 생각보다 고생을 했다.__<br>
알고보니 ```conda package manager```를 사용하고 있어서 내가 설치를 했는데 설치가 안되있다고 나오는 문제? 가 있었다.<br>
원인은 모르겠다. ```conda package manager```를 끄니깐 제대로 되었다.<br>

<br>

### 5월 26일
- __단체 사진 업로드 구현__ <br>
단체 사진을 업로드 하는 과정을 구현해야 하는데 사용자 입장에서 친구 정보를 얻어내는 과정을 버튼을 눌러서 해야 하는 것이 불편하다고 생각이 되었다. 그래서 그 부분을 단체 사진을 업로드하고 서비스를 시작하는 단계로 보이면서 backend에서는 두 가지를 동시에 처리하면 어떨까라고 생각을 하게 되었다. 따라서, ```ajax```로 ```kakao API```의 결과만 보내는 것이 아니라, image (사실은 image의 src)를 ```JSON``` 형태로 묶어서 보내보았다! 다행히도 보내는 것은 성공.<br>

- __전송된 src을 해독하여 이미지로 저장__<br>
그 다음에 해야할 일은 보내진 src을 decode해보니 ```data URI``` 형태 (구글링했는데 이런 형태라고 함) 로 되어 있었다. 이거를 내가 아는 이미지 파일로 만들거나 저장을 해야 한다. ```data URI```의 data 부분이 ```base64```로 encoding이 되어 있기 때문에, ```a2b_base64```함수를 이용해서 binary data를 만들고 파일로 저장할 수 있었다.<br>

- __각 프로필 사진에서 1개 밖에 못 가져옴__ <br>
현재 상황인데, 당연히 고쳐야 하는 부분이다. ```face_encodings``` 의 결과로 나오는 list의 길이를 따로 저장해서 각 프로필 사진에서 여러 사람의 얼굴이 있어도 모두 처리할 수 있도록 할 예정. 하지만, 여러 사람의 얼굴 중 진짜 친구가 누구인지는 당연히 모를 것이다.<br>

- __PIL 라이브러리 한글?__ <br>
결과를 보기 위해서 얼굴인 부분에 사각형을 그려주고 누구라고 인식했는지를 보려고 했는데, 한글이 안되는 것 같다. ```Pillow``` 나 opencv 같은 다른 라이브러리를 사용할 예정.결과를 보기 위해서 얼굴인 부분에 사각형을 그려주고 누구라고 인식했는지를 보려고 했는데, 한글이 안되는 것 같다. ```Pillow``` 나 ```opencv``` 같은 다른 라이브러리를 사용할 예정.<br>

- __얼굴 거리 계산에 따른 결정 알고리즘__ <br>
가장 거리가 작은 사람을 무조건 선택하면 친구 목록에 없는 사람을 인식 못하는 것이 정답인데, 인식을 해버린다. 그러면 안되므로 가장 거리가 작은 사람을 고르되, 그 거리에 대한 threshold을 적용해야 한다. 0.5로 잡았는데 애매하다.<br>

- __사용자 본인의 얼굴이 known에 없다__ <br>
생각을 조금만 하면 당연한 것이였는데, 친구 API에 나온 결과만 사용하기 때문에 내 프로필 사진과 내 이름을 모른다. 물론 초대 리스트를 만들 때 본인은 없어도 되지만, 본인의 얼굴이 다른 사람을 인식하거나 본인의 얼굴이 있는 사진만 서비스가 가능하게 하는 방식을 만들기 위해서는 필요할 것 같다.<br>
